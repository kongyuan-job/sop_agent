# 需求背景
我需要设计一个指标问数的AIAgent系统，用户通过agent助手页面提问，查询某个指标的数据，可以询问指标同比，指标环比，以及与某个标杆的指标的对比。
为了实现这个系统。

# 功能清单
需要完成下面几个功能：
1、构建指标语义
2、指标通用tools
3、agent 创建功能
4、agent 指标问数功能

## 构建指标语义功能
1、数据库数据源配置
 配置数据库的ip、端口、schema、账号和密码，并具备增删改查和连通性测试功能。
2、指标语义定义
 2.1、指标基础信息：
  2.1.1 指标的名称
  2.1.2 指标同义词
  2.1.3 指标的计量单位
  2.1.4 指标的评估标准
  2.1.5 指标的计算公式
 2.2、指标字段信息：
  2.2.1、指标的字段名、字段类型、字段描述
  2.2.2、指标的时间维度字段名、字段类型、字段描述(比如哪种格式，比如yyyyMM、yyyy-MM-dd等)
  2.2.3、指标的其他维度字段名、字段类型、字段描述
3、指标关系定义
 指标与指标父子关系。当前只设计父子关系，或许再扩展其他关系

## 指标tools
1、查询指标语义的tool
通过指标名查询指标语义信息。
指标语义信息包括:指标的基础信息，指标的字段信息和指标关系信息（父指标是谁，子指标有哪些）

2、查询指标值的tool
通指标名和时间维度字段值和其他维度字段值，获取当前指标的指标值，同比和环比。
以及同维度层级的子指标的指标值，同比和环比。

## agent 创建功能
使用agent助手前，需要先创建agent。
1、agent的创建页面。 
配置agent的名字和描述。
创建好后，点击agent，进去agent的配置页面。
2、配置页面，有以下菜单：
2.1、指标菜单
可以选择哪些指标可以参与问数
2.2、指标问数菜单
点击展示一个类型copilot的输入框进行指标问数，需要流式展示agent执行过程的流程和最终结果
支持生成报告的功能
如果用户选择的生成报告（HTML），最终结果是一个可以现在html报告。默认不开启生成报告功能，需要用户勾选。
2.3、sop配置页面
1）定义SOP的名称
2）定义SOP的场景描述
3）定义SOP的任务清单
 任务的名称
 任务的详情
 任务涉及的工具
4）定义SOP的任务间依赖关系（可以用画布来实现，拖拉拽的功能）
5）SOP的报告模板，可不配置。

## agent 指标问数功能
建议用langchain/langgraph实现agent的工作流程。
agent的工作流程见下图
<img src="./agent工作流程.png">