# 指标问数AIAgent系统 - 需求Excel清单

说明：表格按核心模块分类，涵盖所有功能需求，细化需求内容、类型及备注，适配Excel导出使用，确保每一项需求可落地、可追溯。

|序号|核心模块|子模块/功能点|需求详细内容|需求类型|备注|
|---|---|---|---|---|---|
|1|构建指标语义模块|数据库数据源配置-多类型适配|支持配置多种数据库类型（适配指标数据存储场景），配置项包含：数据库IP、端口号、Schema名称、登录账号、登录密码|功能性需求|适配不同指标存储场景，支持多数据源并行|
|2||数据库数据源配置-增删改查|提供数据源的增、删、改、查全操作，支持多数据源并行配置（应对不同指标存储在不同数据库的场景）|功能性需求|可批量管理多个数据源，操作便捷|
|3||数据库数据源配置-连通性测试|具备数据源连通性测试功能，配置完成后可一键测试连接是否正常，异常时给出明确提示（如IP错误、密码错误、端口未开放等）|功能性需求|异常提示需具体，便于用户排查问题|
|4||数据库数据源配置-信息加密|数据源配置信息加密存储，保障数据库账号密码安全，不泄露敏感信息|安全性需求|重点保障账号密码加密，符合数据安全规范|
|5|构建指标语义模块|指标语义定义-指标基础信息-指标名称|指标名称：唯一标识，不可重复，需简洁明了（如“月度活跃用户数”“季度营收”）|功能性需求|需做唯一性校验，避免重复定义|
|6||指标语义定义-指标基础信息-指标同义词|指标同义词：支持配置多个同义词（如“月活”对应“月度活跃用户数”），提升Agent对用户提问的识别率|功能性需求|同义词可灵活添加、删除，关联对应主指标|
|7||指标语义定义-指标基础信息-计量单位|指标计量单位：明确指标的计量标准（如“个”“万元”“百分比”“次”），用于结果展示的标准化|功能性需求|计量单位统一规范，适配结果展示场景|
|8||指标语义定义-指标基础信息-评估标准|指标的评估标准：可选配置，定义指标的正常范围、优秀范围等（如“营收同比增长≥10%为优秀”），辅助Agent解读结果|功能性需求|可选配置，不强制要求，用于结果辅助解读|
|9||指标语义定义-指标基础信息-计算公式|指标的计算公式：明确指标的计算逻辑（如“营收=销量×单价”“同比增长率=(本期值-上年同期值)/上年同期值×100%”），支撑Agent精准计算衍生数据|功能性需求|计算公式需清晰，支撑Agent自动计算同比、环比等衍生数据|
|10||指标语义定义-指标字段信息-核心字段|核心字段信息：明确指标对应的数据库字段名、字段类型（如int、varchar、datetime）、字段描述，确保Agent能精准定位数据来源|功能性需求|关联对应数据源，字段信息需与数据库一致|
|11||指标语义定义-指标字段信息-时间维度字段|时间维度字段：明确指标对应的时间维度字段名、字段类型、时间格式（如yyyyMM、yyyy-MM-dd、yyyy-Q），支撑同比、环比查询（核心适配时间维度筛选）|功能性需求|时间格式统一，支撑同比、环比的自动计算|
|12||指标语义定义-指标字段信息-其他维度字段|其他维度字段：明确指标的非时间维度字段（如“区域”“产品类型”“渠道”），字段名、字段类型、字段描述，支撑多维度指标查询（如“北京区域月度活跃用户数”）|功能性需求|可配置多个非时间维度，支撑多维度筛选查询|
|13||指标关系定义-父子关系配置|核心支持指标父子关系定义（当前版本优先实现），如“总营收”为父指标，“线上营收”“线下营收”为子指标|功能性需求|当前版本优先实现父子关系，后续可扩展|
|14||指标关系定义-父子关系可视化配置|支持可视化配置父子关系，可快速关联父指标与子指标，明确父子指标的计算关联（如父指标=所有子指标求和）|功能性需求|可视化操作，便捷配置，明确计算关联逻辑|
|15|构建指标语义模块|指标关系定义-关系扩展接口|预留关系扩展接口，后续可新增指标间的其他关联关系（如关联关系、对比关系），无需重构整体语义体系|扩展性需求|预留接口，便于后续功能扩展，降低重构成本|
|16|指标通用Tools模块|查询指标语义的Tool-核心功能|核心功能：通过用户提问中的指标名（或同义词），快速查询该指标的完整语义信息，为Agent解析提问、定位数据提供支撑|功能性需求|Agent问数的核心支撑工具，需快速响应|
|17||查询指标语义的Tool-返回内容|查询返回内容：需包含指标基础信息（名称、同义词、计量单位等）、指标字段信息（核心字段、时间/其他维度字段）、指标关系信息（父指标名称、所有子指标列表）|功能性需求|返回内容完整，支撑Agent后续解析和工具调用|
|18||查询指标语义的Tool-模糊查询|支持模糊查询：当用户输入的指标名不完整时，可返回匹配度最高的指标语义列表，供Agent进一步确认（如输入“活跃用户”，返回“月度活跃用户数”“年度活跃用户数”语义）|功能性需求|提升Agent对模糊提问的识别能力，减少用户追问|
|19||查询指标值的Tool-核心功能|核心功能：根据Agent传入的参数（指标名、时间维度字段值、其他维度字段值），自动连接对应数据源，查询并计算指标的相关数据|功能性需求|自动连接数据源，无需人工干预|
|20||查询指标值的Tool-支持查询内容-基础指标值|基础指标值：当前指标在指定时间、指定维度下的原始数值|功能性需求|核心查询内容，精准返回原始数值|
|21|指标通用Tools模块|查询指标值的Tool-支持查询内容-同比数据|同比数据：自动计算当前指标与上年同期（同时间维度）的数值对比、增长率|功能性需求|基于时间维度字段自动计算，无需额外配置|
|22||查询指标值的Tool-支持查询内容-环比数据|环比数据：自动计算当前指标与上一周期（同时间维度）的数值对比、增长率（如月度环比=本月值/上月值-1）|功能性需求|支持不同时间周期（月、季、年）的环比计算|
|23||查询指标值的Tool-支持查询内容-子指标关联查询|子指标关联查询：自动查询同维度层级下，该指标所有子指标的指标值、同比、环比数据（如查询“总营收”，同步返回其下所有子指标的相关数据）|功能性需求|基于指标父子关系，自动关联查询子指标数据|
|24||查询指标值的Tool-异常处理|异常处理：当查询条件不完整（如缺少时间维度）、数据源连接失败、指标无对应数据时，返回明确的异常提示，供Agent反馈给用户或重新调整查询条件|功能性需求|异常提示具体，支撑Agent反馈用户并调整查询|
|25|Agent创建与配置模块|Agent创建页面-创建表单|提供简洁的创建表单，核心配置项：Agent名称（唯一标识，简洁易懂）、Agent描述（说明该Agent的用途，如“运营指标专属问数Agent”“营收指标问数Agent”）|功能性需求|表单简洁，Agent名称需唯一性校验|
|26||Agent创建页面-Agent列表展示|创建完成后，支持Agent列表展示，可快速查看所有已创建Agent的名称、描述、创建时间，支持Agent的编辑、删除操作|功能性需求|列表展示关键信息，操作便捷（编辑、删除）|
|27||Agent创建页面-进入配置页面|点击已创建的Agent，可直接进入该Agent的专属配置页面，开展后续配置操作|功能性需求|跳转便捷，关联对应Agent的配置内容|
|28||Agent配置页面-指标菜单-核心功能|核心功能：配置该Agent可参与问数的指标范围，避免无关指标干扰|功能性需求|精准控制Agent的问数范围，提升问数准确性|
|29||Agent配置页面-指标菜单-操作方式|操作方式：提供指标勾选功能，从已定义的所有指标中，勾选该Agent可支持的指标（支持批量勾选、批量取消）|功能性需求|支持批量操作，提升配置效率|
|30||Agent配置页面-指标菜单-关联显示|关联显示：勾选指标后，可快速查看该指标的核心语义（名称、计量单位），确认配置是否正确|功能性需求|辅助用户确认配置，避免选错指标|
|31||Agent配置页面-指标问数菜单-问数交互|问数交互：提供类似Copilot的输入框，支持用户输入自然语言提问（如“查询2024年3月月度活跃用户数的同比和环比”），输入框支持占位提示、历史提问记录回溯|功能性需求|输入框友好，支持历史回溯，提升用户体验|
|32|Agent创建与配置模块|Agent配置页面-指标问数菜单-执行过程展示|执行过程展示：采用流式展示方式，实时呈现Agent的执行流程（如“正在解析您的提问→正在查询指标语义→正在调用指标查询工具→正在计算同比数据→生成结果”），让用户清晰了解问数进度|功能性需求|流式展示，实时更新，用户可直观查看进度|
|33||Agent配置页面-指标问数菜单-结果展示|结果展示：最终展示指标的原始数值、同比、环比（或标杆对比）数据，格式简洁易懂，支持数值高亮（如同比增长为正标绿、为负标红）|功能性需求|数值高亮，格式清晰，便于用户快速解读结果|
|34||Agent配置页面-指标问数菜单-报告生成功能|报告生成功能：支持用户勾选“生成HTML报告”，勾选后，系统自动将问数结果、执行流程、指标说明整合为HTML报告，支持在线预览、下载（默认不开启，需用户手动勾选）|功能性需求|默认不开启，用户手动勾选，支持预览和下载|
|35||Agent配置页面-SOP配置页面-SOP名称|SOP名称：定义SOP的唯一名称（如“指标同比环比问数SOP”“标杆指标对比SOP”），便于区分和管理|功能性需求|名称唯一，简洁明了，便于区分不同SOP|
|36||Agent配置页面-SOP配置页面-SOP场景描述|SOP场景描述：明确该SOP的适用场景（如“适用于单个指标的同比、环比查询场景”“适用于单个指标与指定标杆指标的对比场景”）|功能性需求|场景描述清晰，便于用户选择合适的SOP|
|37||Agent配置页面-SOP配置页面-SOP任务清单-任务配置|每个SOP包含多个有序任务，每个任务需配置：任务名称（简洁明确，如“解析用户提问”“查询指标语义”）、任务详情（说明任务的具体执行要求）、任务涉及的工具（从指标通用Tools中选择，如“查询指标语义的Tool”“查询指标值的Tool”）|功能性需求|任务配置完整，关联对应工具，支撑流程执行|
|38||Agent配置页面-SOP配置页面-SOP任务清单-任务操作|支持任务的增、删、改操作，可调整任务顺序|功能性需求|任务管理灵活，可根据需求调整|
|39||Agent配置页面-SOP配置页面-任务间依赖关系|任务间依赖关系：采用画布拖拉拽方式实现，支持可视化配置各任务的执行顺序和依赖关系（如“必须完成‘解析用户提问’任务，才能执行‘查询指标语义’任务”），拖拽后可自动保存依赖关系，支持依赖关系的修改和删除|功能性需求|可视化拖拉拽，操作便捷，依赖关系清晰|
|40|Agent创建与配置模块|Agent配置页面-SOP配置页面-SOP报告模板|SOP报告模板：可选配置，用户可自定义HTML报告的模板（如报告标题、内容布局、样式），配置后，该SOP执行生成的报告将按照模板展示；不配置则使用系统默认模板|功能性需求|可选配置，支持自定义，适配不同报告展示需求|
|41|Agent指标问数核心模块|技术选型|技术选型：建议采用LangChain/LangGraph实现Agent的工作流程，利用LangGraph的图结构特性，灵活定义任务节点、依赖关系，适配SOP配置的流程，支持流程的动态调整|技术性需求|基于LangChain/LangGraph，适配SOP流程，支持动态调整|
|42||Agent工作流程-节点1：提问解析|节点1：提问解析：接收用户在Agent问数输入框中的自然语言提问，解析出核心需求（如指标名、时间维度、查询类型：同比/环比/标杆对比）|功能性需求|精准解析用户提问，提取核心查询参数|
|43||Agent工作流程-节点2：指标语义查询|节点2：指标语义查询：调用“查询指标语义的Tool”，根据解析出的指标名，获取指标完整语义信息，确认指标合法性（是否在该Agent的配置指标范围内）|功能性需求|调用对应Tool，确认指标合法性，支撑后续流程|
|44||Agent工作流程-节点3：参数校验|节点3：参数校验：校验解析出的查询参数（时间维度、其他维度）是否完整、合法，若不完整，自动向用户追问缺失参数（如“请明确查询的时间范围，如2024年3月”）|功能性需求|参数不完整时自动追问，提升交互体验|
|45||Agent工作流程-节点4：工具调用|节点4：工具调用：根据查询需求，调用“查询指标值的Tool”，传入指标名、时间维度、其他维度等参数，查询指标相关数据（原始值、同比、环比等）|功能性需求|自动调用Tool，传入正确参数，获取查询数据|
|46||Agent工作流程-节点5：结果处理|节点5：结果处理：对工具返回的数据进行整理、计算（如补充增长率说明、格式化数值），结合指标语义，生成简洁易懂的自然语言结果|功能性需求|结果格式化、自然语言化，便于用户理解|
|47||Agent工作流程-节点6：报告生成（可选）|节点6：报告生成（可选）：若用户勾选“生成HTML报告”，则根据SOP报告模板，整合执行流程、查询参数、指标结果，生成HTML报告，支持预览和下载|功能性需求|与指标问数菜单的报告生成功能联动|
|48||Agent工作流程-节点7：结果反馈|节点7：结果反馈：将处理后的结果（或报告链接）流式反馈给用户，同时展示完整的执行流程日志，供用户查看|功能性需求|流式反馈结果，展示流程日志，提升透明度|
|49|Agent指标问数核心模块|异常处理|异常处理：在工作流程的每个节点，均需添加异常处理逻辑，如工具调用失败、数据查询无结果、参数非法等，Agent需及时向用户反馈异常信息，并提供解决方案（如“数据源连接失败，请检查数据源配置”）|功能性需求|全节点异常覆盖，反馈具体且提供解决方案|
|50||交互优化|交互优化：支持用户对返回结果进行追问（如“再查询该指标与标杆A的对比数据”），Agent可复用之前的查询参数，无需用户重复输入，提升交互体验|功能性需求|支持追问，复用查询参数，提升用户体验|
> （注：文档部分内容可能由 AI 生成）